import{E as B}from"./excelFileInput-cfb64995.js";import{B as F,P as b,G as O}from"./global-086da01c.js";import{L as T,D as M}from"./LoadingAnimation-9902bb83.js";import{_ as A}from"./ToggleButton-05df5153.js";import{_ as S,o as h,c as g,a as t,F as N,r as v,n as u,t as c,e as p,f as d,g as k}from"./index-2a712484.js";const E={props:{products:{type:Array,required:!0},errorToggle:{type:Boolean,required:!0,default:!1}},computed:{filteredProducts(){return this.errorToggle?this.products.filter(n=>this.hasMissingFiles(n.files)):this.products}},methods:{hasMissingFiles(n){if(n.dxf==="NOK"||n.pdf==="NOK"||n.stp==="NOK"||n.stl==="NOK"||n.flatDxf==="NOK")return!0}}},U=t("thead",null,[t("tr",null,[t("th",{class:"bg-blue"},"Product Name"),t("th",{class:"bg-blue"},".dxf"),t("th",{class:"bg-blue"},".pdf"),t("th",{class:"bg-blue"},".stp"),t("th",{class:"bg-blue"},"_FLAT.dxf"),t("th",{class:"bg-blue"},".stl")])],-1);function q(n,e,s,i,l,r){return h(),g("table",null,[U,t("tbody",null,[(h(!0),g(N,null,v(r.filteredProducts,(o,D)=>(h(),g("tr",{key:D},[t("td",{class:u({"bg-red":r.hasMissingFiles(o.files),"bg-green":!r.hasMissingFiles(o.files)})},c(o.number),3),t("td",{class:u({"bg-red":o.files.dxf==="NOK","bg-green":o.files.dxf==="OK","bg-gray":o.files.dxf==="N/A"})},c(o.files.dxf),3),t("td",{class:u({"bg-red":o.files.pdf==="NOK","bg-green":o.files.pdf==="OK","bg-gray":o.files.pdf==="N/A"})},c(o.files.pdf),3),t("td",{class:u({"bg-red":o.files.stp==="NOK","bg-green":o.files.stp==="OK","bg-gray":o.files.stp==="N/A"})},c(o.files.stp),3),t("td",{class:u({"bg-red":o.files.flatDxf==="NOK","bg-green":o.files.flatDxf==="OK","bg-gray":o.files.flatDxf==="N/A"})},c(o.files.flatDxf),3),t("td",{class:u({"bg-red":o.files.stl==="NOK","bg-green":o.files.stl==="OK","bg-gray":o.files.stl==="N/A"})},c(o.files.stl),3)]))),128))])])}const C=S(E,[["render",q]]);let x="",y="",m=[],f="";const G={name:"TekeningenView",components:{ExcelFileInput:B,ButtonDevion:F,LoadingAnimation:T,Dropdown:M,FileTableVue:C,BasicToggleSwitch:A},data(){return{LinkModelMontage:!1,LinkModelLassen:!1,bewerkingenStatus:{},uniqueBewerkingen:[],bewerkingenData:[],UniqueNabehandelingen:[],nabehandelingenStatus:{},NabehandelingenData:[],errorToggle:!1,file:{components:{ExcelFileInput:B},id:"file",label:"BOM file",error:!1,showLabel:!0,filename:"Kies een bestand",showFile:!0},button:{components:{ButtonDevion:F},label:"IMPORTEREN",isDisabled:!0,showButton:!0},loading:{components:{LoadingAnimation:T},showLoad:!1},dropdownFolders:{components:{Dropdown:M},id:"dropdownFolders",label:"Folder",options:[],error:!1},fileTable:{components:{FileTableVue:C},products:[],showTable:!1,errorToggle:this.errorToggle}}},created(){this.getFolders()},watch:{},methods:{handleFileUpdate(n){this.file.error=!1,this.file.showLabel=!1,this.file.showButton=!0,this.file.filename=n.name,this.file.file=n,f!=""&&(this.button.isDisabled=!1)},async handleButton(){this.loading.showLoad=!0;let n="devion/ets/transformbomexcel";x=this.file.file.previewBase64.replace("data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",""),y=this.file.filename;var e={FileContents:x};n+="?fileName="+y,b(n,e).then(s=>{this.button.isDisabled=!0,m=JSON.parse(s)[0][0],n="devion/tekeningen/check",n+="?project="+f.replaceAll(" ","%20"),b(n,m).then(i=>{m=JSON.parse(i),this.loading.showLoad=!1,this.fileTable.products=this.filterItems(JSON.parse(i)),this.fileTable.showTable=!0,this.GetNabehandelingen(this.fileTable.products),this.GetDifferentNabehandelingen(),this.GetBewerkingen(this.fileTable.products),this.GetDifferentBewerkingen()}).catch(i=>{this.dropdownFolders.error=!0,console.error(i)}),this.loading.showLoad=!1}).catch(s=>{console.error(s.response)})},getFolders(){O("devion/foldernames").then(e=>{let s=e.map(i=>({value:i,label:i}));this.dropdownFolders.options=s}).catch(e=>{console.error(e.response)})},async handledropdownFoldersSelected(n){f=n,this.file.name!=""&&(this.button.isDisabled=!1)},filterItems(n){const e=[];return n&&(n.parts!=[]&&n.parts.forEach(s=>{e.push(...this.filterItems(s))}),(n.files.dxf!="N/A"||n.files.pdf!="N/A"||n.files.stp!="N/A"||n.files.stl!="N/A"||n.files.flatDxf!="N/A")&&e.push(n)),e.sort((s,i)=>s.number.localeCompare(i.number))},async handleCreateButton(){if(this.LinkModelMontage){let n={MainPart:m,Project:f,Boeken:["Monteren"],hoofdartikel:this.file.filename.split("_")[0]};b("devion/tekeningen/createbooks",n).catch(s=>{console.error(s)})}this.LinkModelLassen&&(console.log("Lassen"),this.Check(m,"Lassen")),alert("Boeken gemaakt")},async Check(n,e){if(e=="Monteren"){if(n!=null){let s={MainPart:n,Project:f,Boeken:["Monteren"],hoofdartikel:this.file.filename.split("_")[0]},i="devion/tekeningen/createbooks";this.LinkModelMontage&&b(i,s).catch(l=>{console.error(l)}),n.parts.forEach(l=>{l!=null&&(l.bewerking1.toLowerCase()=="monteren"?this.Check(l,"Monteren"):l.bewerking1.toLowerCase()=="lassen"&&this.Check(l,"Lassen"))})}}else if(e=="Lassen"&&(console.log("lassen"),n!=null&&n.parts!=[])){if(n.bewerking1.toLowerCase()=="lassen"){let s={MainPart:n,Project:f,Boeken:["Lassen"],hoofdartikel:n.number},i="devion/tekeningen/createbooks";this.LinkModelLassen&&b(i,s).catch(l=>{console.error(l)})}n.parts.forEach(s=>{s!=null&&(s.bewerking1.toLowerCase()=="monteren"?this.Check(s,"Monteren"):s.bewerking1.toLowerCase()=="lassen"&&this.Check(s,"Lassen"))})}},GetBewerkingen(n){n.forEach(e=>{if(e.bewerking1!=null&&e.bewerking1!=""&&e.bewerking1!="-"){let s={bewerking:e.bewerking1.toLowerCase(),artikel:e.number,leverancier:e.mainSupplier};this.bewerkingenData.push(s)}if(e.bewerking2!=null&&e.bewerking2!=""&&e.bewerking2!="-"){let s={bewerking:e.bewerking2.toLowerCase(),artikel:e.number,leverancier:e.mainSupplier};this.bewerkingenData.push(s)}if(e.bewerking3!=null&&e.bewerking3!=""&&e.bewerking3!="-"){let s={bewerking:e.bewerking3.toLowerCase(),artikel:e.number,leverancier:e.mainSupplier};this.bewerkingenData.push(s)}if(e.bewerking4!=null&&e.bewerking4!=""&&e.bewerking4!="-"){let s={bewerking:e.bewerking4.toLowerCase(),artikel:e.number,leverancier:e.mainSupplier};this.bewerkingenData.push(s)}})},GetDifferentNabehandelingen(){this.UniqueNabehandelingen=[...new Set(this.NabehandelingenData.map(n=>n.nabehandeling))],this.UniqueNabehandelingen.forEach(n=>{const e=this.NabehandelingenData.findIndex(s=>s.nabehandeling===n);e!==-1&&this.NabehandelingenData.splice(e,1,!1)})},GetNabehandelingen(n){n.forEach(e=>{if(e.nabehandeling1!=null&&e.nabehandeling1!=""&&e.nabehandeling1!="-"){let s={nabehandeling:e.nabehandeling1.toLowerCase(),artikel:e.number};this.NabehandelingenData.push(s)}if(e.nabehandeling2!=null&&e.nabehandeling2!=""&&e.nabehandeling2!="-"){let s={nabehandeling:e.nabehandeling2.toLowerCase(),artikel:e.number};this.NabehandelingenData.push(s)}})},GetDifferentBewerkingen(){this.uniqueBewerkingen=[...new Set(this.bewerkingenData.map(n=>n.bewerking))],this.uniqueBewerkingen.forEach(n=>{const e=this.bewerkingenData.findIndex(s=>s.bewerking===n);e!==-1&&this.bewerkingenData.splice(e,1,!1)})},handleKopieerButton(){let n=[];this.bewerkingenData.forEach(i=>{this.bewerkingenStatus[i.bewerking]&&(n.includes(i.bewerking)||n.push(i.bewerking))});var e={Folders:n,BasePath:f};b("devion/tekeningen/bewerkingen/delete",e),this.bewerkingenData.forEach(i=>{if(this.bewerkingenStatus[i.bewerking]){var l={bewerking:i.bewerking,artikel:i.artikel,leverancier:i.leverancier,project:f};b("devion/tekeningen/kopieer/bewerkingen",l).catch(o=>{console.error(o)})}}),alert("Kopieer actie voltooid")},handleKopieerButtonNabehandelingen(){let n=[];this.NabehandelingenData.forEach(l=>{this.nabehandelingenStatus[l.nabehandeling]&&(n.includes(l.nabehandeling)||n.push(l.nabehandeling))});var e={Folders:n,BasePath:f};let s="devion/tekeningen/nabehandelingen/delete";b(s,e);let i=[];this.NabehandelingenData.forEach(l=>{if(this.nabehandelingenStatus[l.nabehandeling]){var r={nabehandeling:l.nabehandeling,artikel:l.artikel,project:f,hoofdArtikel:this.file.filename.split("_")[0]};i.push(r)}}),s="devion/tekeningen/kopieer/nabehandelingen",b(s,i).catch(l=>{console.error(l)}),this.showModalNabehandelingen=!0,alert("Kopieer actie voltooid")}}},I=t("h1",null,"Tekeningen",-1),j={key:0,class:"c-load"},P={key:1},J={class:"c-boek"},R=t("p",null,"Toggle Errors:",-1),z={key:2},W=t("h2",null,"Boeken",-1),H={class:"c-boek"},Q=t("p",null,"Maak boeken voor montage:",-1),X={class:"c-boek"},Y=t("p",null,"Maak boeken voor lassen:",-1),Z={key:3},$=t("h2",null,"Bewerkingen",-1),ee={key:4},ne=t("h2",null,"Nabehandelingen",-1);function le(n,e,s,i,l,r){const o=p("excelFileInput"),D=p("Dropdown"),_=p("ButtonDevion"),V=p("LoadingAnimation"),w=p("BasicToggleSwitch"),K=p("FileTableVue");return h(),g("div",null,[I,d(o,{label:l.file.label,error:l.file.error,filename:l.file.filename,showFile:l.file.showFile,onFileUpdated:r.handleFileUpdate},null,8,["label","error","filename","showFile","onFileUpdated"]),d(D,{id:l.dropdownFolders.id,label:l.dropdownFolders.label,options:l.dropdownFolders.options,error:l.dropdownFolders.error,onOptionSelected:r.handledropdownFoldersSelected,class:"c-dropdown"},null,8,["id","label","options","error","onOptionSelected"]),d(_,{label:l.button.label,isDisabled:l.button.isDisabled,showButton:l.button.showButton,onClick:r.handleButton,class:"c-button"},null,8,["label","isDisabled","showButton","onClick"]),l.loading.showLoad?(h(),g("div",j,[d(V,{showLoad:l.loading.showLoad},null,8,["showLoad"])])):k("",!0),l.fileTable.showTable?(h(),g("div",P,[t("div",J,[R,d(w,{modelValue:l.errorToggle,"onUpdate:modelValue":e[0]||(e[0]=a=>l.errorToggle=a),class:"c-toggle"},null,8,["modelValue"])]),d(K,{products:l.fileTable.products,errorToggle:l.errorToggle},null,8,["products","errorToggle"])])):k("",!0),l.fileTable.showTable?(h(),g("div",z,[W,t("div",H,[Q,d(w,{modelValue:l.LinkModelMontage,"onUpdate:modelValue":e[1]||(e[1]=a=>l.LinkModelMontage=a),class:"c-toggle"},null,8,["modelValue"])]),t("div",X,[Y,d(w,{modelValue:l.LinkModelLassen,"onUpdate:modelValue":e[2]||(e[2]=a=>l.LinkModelLassen=a),class:"c-toggle"},null,8,["modelValue"])]),d(_,{label:"Maak boeken",isDisabled:!1,showButton:!0,onClick:r.handleCreateButton,class:"c-button"},null,8,["onClick"])])):k("",!0),l.fileTable.showTable?(h(),g("div",Z,[$,(h(!0),g(N,null,v(l.uniqueBewerkingen,a=>(h(),g("div",{key:a,class:"c-boek"},[t("p",null,c(a),1),d(w,{modelValue:l.bewerkingenStatus[a],"onUpdate:modelValue":L=>l.bewerkingenStatus[a]=L,class:"c-toggle"},null,8,["modelValue","onUpdate:modelValue"])]))),128)),d(_,{label:"Kopieer bewerkingen",isDisabled:!1,showButton:!0,onClick:r.handleKopieerButton,class:"c-button"},null,8,["onClick"])])):k("",!0),l.fileTable.showTable?(h(),g("div",ee,[ne,(h(!0),g(N,null,v(l.UniqueNabehandelingen,a=>(h(),g("div",{key:a,class:"c-boek"},[t("p",null,c(a),1),d(w,{modelValue:l.nabehandelingenStatus[a],"onUpdate:modelValue":L=>l.nabehandelingenStatus[a]=L,class:"c-toggle"},null,8,["modelValue","onUpdate:modelValue"])]))),128)),d(_,{label:"Kopieer Nabehandelingen",isDisabled:!1,showButton:!0,onClick:r.handleKopieerButtonNabehandelingen,class:"c-button"},null,8,["onClick"])])):k("",!0)])}const re=S(G,[["render",le]]);export{re as default};
