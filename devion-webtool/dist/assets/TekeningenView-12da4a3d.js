import{E as x}from"./excelFileInput-a06535d0.js";import{B as C,P as c,G as j}from"./global-d1d627d6.js";import{L as y,D as M}from"./LoadingAnimation-baca3cd3.js";import{_ as q}from"./ToggleButton-fa81feb7.js";import{_ as K,o as h,c as f,a as o,F as T,r as F,n as b,t as u,e as p,f as d,g as k}from"./index-894bacca.js";const I={props:{products:{type:Array,required:!0},errorToggle:{type:Boolean,required:!0,default:!1}},computed:{filteredProducts(){return this.errorToggle?this.products.filter(e=>this.hasMissingFiles(e.files)):this.products}},methods:{hasMissingFiles(e){if(e.dxf==="NOK"||e.pdf==="NOK"||e.stp==="NOK"||e.stl==="NOK"||e.flatDxf==="NOK"||e.png==="NOK")return!0}}},U=o("thead",null,[o("tr",null,[o("th",{class:"bg-blue"},"Product Name"),o("th",{class:"bg-blue"},".dxf"),o("th",{class:"bg-blue"},".pdf"),o("th",{class:"bg-blue"},".stp"),o("th",{class:"bg-blue"},"_FLAT.dxf"),o("th",{class:"bg-blue"},".stl"),o("th",{class:"bg-blue"},".png")])],-1);function G(e,n,l,s,i,a){return h(),f("table",null,[U,o("tbody",null,[(h(!0),f(T,null,F(a.filteredProducts,(t,v)=>(h(),f("tr",{key:v},[o("td",{class:b({"bg-red":a.hasMissingFiles(t.files),"bg-green":!a.hasMissingFiles(t.files)})},u(t.number),3),o("td",{class:b({"bg-red":t.files.dxf==="NOK","bg-green":t.files.dxf==="OK","bg-gray":t.files.dxf==="N/A"})},u(t.files.dxf),3),o("td",{class:b({"bg-red":t.files.pdf==="NOK","bg-green":t.files.pdf==="OK","bg-gray":t.files.pdf==="N/A"})},u(t.files.pdf),3),o("td",{class:b({"bg-red":t.files.stp==="NOK","bg-green":t.files.stp==="OK","bg-gray":t.files.stp==="N/A"})},u(t.files.stp),3),o("td",{class:b({"bg-red":t.files.flatDxf==="NOK","bg-green":t.files.flatDxf==="OK","bg-gray":t.files.flatDxf==="N/A"})},u(t.files.flatDxf),3),o("td",{class:b({"bg-red":t.files.stl==="NOK","bg-green":t.files.stl==="OK","bg-gray":t.files.stl==="N/A"})},u(t.files.stl),3),o("td",{class:b({"bg-red":t.files.png==="NOK","bg-green":t.files.png==="OK","bg-gray":t.files.png==="N/A"})},u(t.files.png),3)]))),128))])])}const O=K(I,[["render",G]]);let S="",A="",m=[],g="",_=[],N=[],B=[];const P={name:"TekeningenView",components:{ExcelFileInput:x,ButtonDevion:C,LoadingAnimation:y,Dropdown:M,FileTableVue:O,BasicToggleSwitch:q},data(){return{LinkModelMontage:!1,LinkModelLassen:!1,bewerkingenStatus:{},uniqueBewerkingen:[],bewerkingenData:[],UniqueNabehandelingen:[],nabehandelingenStatus:{},NabehandelingenData:[],errorToggle:!1,showPopup:!1,loginDetails:null,file:{components:{ExcelFileInput:x},id:"file",label:"BOM file",error:!1,showLabel:!0,filename:"Kies een bestand",showFile:!0},button:{components:{ButtonDevion:C},label:"IMPORTEREN",isDisabled:!0,showButton:!0},loading:{components:{LoadingAnimation:y},showLoad:!1},dropdownFolders:{components:{Dropdown:M},id:"dropdownFolders",label:"Folder",options:[],error:!1},fileTable:{components:{FileTableVue:O},products:[],showTable:!1,errorToggle:this.errorToggle}}},created(){this.getFolders()},watch:{},methods:{handleLogin(e){this.loginDetails=e,console.log("Login details:",e)},handleFileUpdate(e){this.file.error=!1,this.file.showLabel=!1,this.file.showButton=!0,this.file.filename=e.name,this.file.file=e,g!=""&&(this.button.isDisabled=!1)},async handleButton(){this.loading.showLoad=!0;let e="devion/ets/transformbomexcel";S=this.file.file.previewBase64.replace("data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",""),A=this.file.filename;var n={FileContents:S};e+="?fileName="+A,c(e,n).then(l=>{this.button.isDisabled=!0,m=JSON.parse(l)[0][0],e="devion/tekeningen/check",e+="?project="+g.replaceAll(" ","%20"),c(e,m).then(s=>{m=JSON.parse(s),this.loading.showLoad=!1,this.fileTable.products=this.filterItems(JSON.parse(s)),B=this.Items(JSON.parse(s)),this.quantityOverdracht(JSON.parse(s),null),this.fileTable.showTable=!0,this.GetNabehandelingen(this.fileTable.products),this.GetDifferentNabehandelingen(),this.GetBewerkingen(this.fileTable.products),this.GetDifferentBewerkingen()}).catch(s=>{this.dropdownFolders.error=!0,console.error(s)}),this.loading.showLoad=!1}).catch(l=>{console.error(l.response)})},getFolders(){j("devion/foldernames").then(n=>{let l=n.map(s=>({value:s,label:s}));this.dropdownFolders.options=l}).catch(n=>{console.error(n.response)})},async handledropdownFoldersSelected(e){g=e,this.file.name!=""&&(this.button.isDisabled=!1)},filterItems(e){const n=[];return e&&(e.parts!=[]&&e.parts.forEach(l=>{this.filterItems(l).forEach(s=>{n.find(a=>a.number===s.number)||n.push(s)})}),(e.files.dxf!="N/A"||e.files.pdf!="N/A"||e.files.stp!="N/A"||e.files.stl!="N/A"||e.files.flatDxf!="N/A"||e.files.png!="N/A")&&(n.find(s=>s.number===e.number)||n.push(e))),n.sort((l,s)=>l.number.localeCompare(s.number))},Items(e){const n=[];return e&&(e.parts!=[]&&e.parts.forEach(l=>{this.filterItems(l).forEach(s=>{n.push(s)})}),(e.files.dxf!="N/A"||e.files.pdf!="N/A"||e.files.stp!="N/A"||e.files.stl!="N/A"||e.files.flatDxf!="N/A"||e.files.png!="N/A")&&n.push(e)),n.sort((l,s)=>l.number.localeCompare(s.number))},quantityOverdracht(e,n){e!=null&&(console.log(n,e),n!=null&&(e.quantity*=n.quantity),e.parts!=[]&&e.parts.forEach(l=>{this.quantityOverdracht(l,e)}))},createMonterenLijst(e){const n=_.findIndex(l=>l.partNumber===e.number);e.bewerking1.toLowerCase()=="monteren"&&(n!==-1?_[n].Aantal+=e.quantity:_.push({partNumber:e.number,Aantal:e.quantity,Done:""}))},createLasLijst(e){const n=N.findIndex(l=>l.partNumber===e.number);e.bewerking1.toLowerCase()=="lassen"&&(n!==-1?N[n].Aantal+=e.quantity:N.push({partNumber:e.number,Aantal:e.quantity,Done:""}))},async handleCreateButton(){if(this.LinkModelMontage){this.Check(m,"Monteren");let n=[];this.fileTable.products.forEach(s=>{s.bewerking1.toLowerCase()=="monteren"&&n.push(s)});var e={hoofdartikel:this.file.filename.split("_")[0],project:g,amount:n.length};let l="devion/tekeningen/createbook";c(l,e).then(()=>{_=[],B.forEach(i=>{this.createMonterenLijst(i)});var s={data:_,project:g,hoofdartikel:this.file.filename.split("_")[0]};l="devion/tekeningen/createmontagelijst",c(l,s).catch(i=>{console.error(i)})}).catch(s=>{console.error(s)})}this.LinkModelLassen&&(this.Check(m,"Lassen"),N=[],B.forEach(l=>{this.createLasLijst(l)}),e={data:N,project:g,hoofdartikel:this.file.filename.split("_")[0]},c("devion/tekeningen/createlaslijst",e).catch(l=>{console.error(l)})),alert("Boeken gemaakt")},async Check(e,n){if(n=="Monteren"){if(e!=null){let l={MainPart:e,Project:g,Boeken:["Monteren"],hoofdartikel:this.file.filename.split("_")[0]},s="devion/tekeningen/createbooks";this.LinkModelMontage&&c(s,l).catch(i=>{console.error(i)}),e.parts.forEach(i=>{i!=null&&(i.bewerking1.toLowerCase()=="monteren"?this.Check(i,"Monteren"):i.bewerking1.toLowerCase()=="lassen"&&this.Check(i,"Lassen"))})}}else if(n=="Lassen"&&e!=null&&e.parts!=[]){if(e.bewerking1.toLowerCase()=="lassen"){let l={MainPart:e,Project:g,Boeken:["Lassen"],hoofdartikel:this.file.filename.split("_")[0]},s="devion/tekeningen/createbooks";this.LinkModelLassen&&c(s,l).catch(i=>{console.error(i)})}e.parts.forEach(l=>{l!=null&&(l.bewerking1.toLowerCase()=="monteren"?this.Check(l,"Monteren"):l.bewerking1.toLowerCase()=="lassen"&&this.Check(l,"Lassen"))})}},GetBewerkingen(e){e.forEach(n=>{if(n.bewerking1!=null&&n.bewerking1!=""&&n.bewerking1!="-"){let l={bewerking:n.bewerking1.toLowerCase(),artikel:n.number,leverancier:n.mainSupplier};this.bewerkingenData.push(l)}if(n.bewerking2!=null&&n.bewerking2!=""&&n.bewerking2!="-"){let l={bewerking:n.bewerking2.toLowerCase(),artikel:n.number,leverancier:n.mainSupplier};this.bewerkingenData.push(l)}if(n.bewerking3!=null&&n.bewerking3!=""&&n.bewerking3!="-"){let l={bewerking:n.bewerking3.toLowerCase(),artikel:n.number,leverancier:n.mainSupplier};this.bewerkingenData.push(l)}if(n.bewerking4!=null&&n.bewerking4!=""&&n.bewerking4!="-"){let l={bewerking:n.bewerking4.toLowerCase(),artikel:n.number,leverancier:n.mainSupplier};this.bewerkingenData.push(l)}})},GetDifferentNabehandelingen(){this.UniqueNabehandelingen=[...new Set(this.NabehandelingenData.map(e=>e.nabehandeling))],this.UniqueNabehandelingen.forEach(e=>{const n=this.NabehandelingenData.findIndex(l=>l.nabehandeling===e);n!==-1&&this.NabehandelingenData.splice(n,1,!1)})},GetNabehandelingen(e){e.forEach(n=>{if(n.nabehandeling1!=null&&n.nabehandeling1!=""&&n.nabehandeling1!="-"){let l={nabehandeling:n.nabehandeling1.toLowerCase(),artikel:n.number};this.NabehandelingenData.push(l)}if(n.nabehandeling2!=null&&n.nabehandeling2!=""&&n.nabehandeling2!="-"){let l={nabehandeling:n.nabehandeling2.toLowerCase(),artikel:n.number};this.NabehandelingenData.push(l)}})},GetDifferentBewerkingen(){this.uniqueBewerkingen=[...new Set(this.bewerkingenData.map(e=>e.bewerking))],this.uniqueBewerkingen.forEach(e=>{const n=this.bewerkingenData.findIndex(l=>l.bewerking===e);n!==-1&&this.bewerkingenData.splice(n,1,!1)})},handleKopieerButton(){let e=[];this.bewerkingenData.forEach(s=>{this.bewerkingenStatus[s.bewerking]&&(e.includes(s.bewerking)||e.push(s.bewerking))});var n={Folders:e,BasePath:g};c("devion/tekeningen/bewerkingen/delete",n),this.bewerkingenData.forEach(s=>{if(this.bewerkingenStatus[s.bewerking]){var i={bewerking:s.bewerking,artikel:s.artikel,leverancier:s.leverancier,project:g};c("devion/tekeningen/kopieer/bewerkingen",i).catch(t=>{console.error(t)})}}),alert("Kopieer actie voltooid")},handleKopieerButtonNabehandelingen(){let e=[];this.NabehandelingenData.forEach(i=>{this.nabehandelingenStatus[i.nabehandeling]&&(e.includes(i.nabehandeling)||e.push(i.nabehandeling))});var n={Folders:e,BasePath:g};let l="devion/tekeningen/nabehandelingen/delete";c(l,n);let s=[];this.NabehandelingenData.forEach(i=>{if(this.nabehandelingenStatus[i.nabehandeling]){var a={nabehandeling:i.nabehandeling,artikel:i.artikel,project:g,hoofdArtikel:this.file.filename.split("_")[0]};s.push(a)}}),l="devion/tekeningen/kopieer/nabehandelingen",c(l,s).catch(i=>{console.error(i)}),this.showModalNabehandelingen=!0,alert("Kopieer actie voltooid")}}},J=o("div",null,[o("h1",null,"Tekeningen")],-1),R={key:0,class:"c-load"},z={key:1},W={class:"c-boek"},H=o("p",null,"Toggle Errors:",-1),Q={key:2},X=o("h2",null,"Boeken",-1),Y={class:"c-boek"},Z=o("p",null,"Maak boeken voor montage:",-1),$={class:"c-boek"},ee=o("p",null,"Maak boeken voor lassen:",-1),ne={key:3},le=o("h2",null,"Bewerkingen",-1),ie={key:4},se=o("h2",null,"Nabehandelingen",-1);function te(e,n,l,s,i,a){const t=p("excelFileInput"),v=p("Dropdown"),L=p("ButtonDevion"),V=p("LoadingAnimation"),w=p("BasicToggleSwitch"),E=p("FileTableVue");return h(),f("div",null,[J,d(t,{label:i.file.label,error:i.file.error,filename:i.file.filename,showFile:i.file.showFile,onFileUpdated:a.handleFileUpdate},null,8,["label","error","filename","showFile","onFileUpdated"]),d(v,{id:i.dropdownFolders.id,label:i.dropdownFolders.label,options:i.dropdownFolders.options,error:i.dropdownFolders.error,onOptionSelected:a.handledropdownFoldersSelected,class:"c-dropdown"},null,8,["id","label","options","error","onOptionSelected"]),d(L,{label:i.button.label,isDisabled:i.button.isDisabled,showButton:i.button.showButton,onClick:a.handleButton,class:"c-button"},null,8,["label","isDisabled","showButton","onClick"]),i.loading.showLoad?(h(),f("div",R,[d(V,{showLoad:i.loading.showLoad},null,8,["showLoad"])])):k("",!0),i.fileTable.showTable?(h(),f("div",z,[o("div",W,[H,d(w,{modelValue:i.errorToggle,"onUpdate:modelValue":n[0]||(n[0]=r=>i.errorToggle=r),class:"c-toggle"},null,8,["modelValue"])]),d(E,{products:i.fileTable.products,errorToggle:i.errorToggle},null,8,["products","errorToggle"])])):k("",!0),i.fileTable.showTable?(h(),f("div",Q,[X,o("div",Y,[Z,d(w,{modelValue:i.LinkModelMontage,"onUpdate:modelValue":n[1]||(n[1]=r=>i.LinkModelMontage=r),class:"c-toggle"},null,8,["modelValue"])]),o("div",$,[ee,d(w,{modelValue:i.LinkModelLassen,"onUpdate:modelValue":n[2]||(n[2]=r=>i.LinkModelLassen=r),class:"c-toggle"},null,8,["modelValue"])]),d(L,{label:"Maak boeken",isDisabled:!1,showButton:!0,onClick:a.handleCreateButton,class:"c-button"},null,8,["onClick"])])):k("",!0),i.fileTable.showTable?(h(),f("div",ne,[le,(h(!0),f(T,null,F(i.uniqueBewerkingen,r=>(h(),f("div",{key:r,class:"c-boek"},[o("p",null,u(r),1),d(w,{modelValue:i.bewerkingenStatus[r],"onUpdate:modelValue":D=>i.bewerkingenStatus[r]=D,class:"c-toggle"},null,8,["modelValue","onUpdate:modelValue"])]))),128)),d(L,{label:"Kopieer bewerkingen",isDisabled:!1,showButton:!0,onClick:a.handleKopieerButton,class:"c-button"},null,8,["onClick"])])):k("",!0),i.fileTable.showTable?(h(),f("div",ie,[se,(h(!0),f(T,null,F(i.UniqueNabehandelingen,r=>(h(),f("div",{key:r,class:"c-boek"},[o("p",null,u(r),1),d(w,{modelValue:i.nabehandelingenStatus[r],"onUpdate:modelValue":D=>i.nabehandelingenStatus[r]=D,class:"c-toggle"},null,8,["modelValue","onUpdate:modelValue"])]))),128)),d(L,{label:"Kopieer Nabehandelingen",isDisabled:!1,showButton:!0,onClick:a.handleKopieerButtonNabehandelingen,class:"c-button"},null,8,["onClick"])])):k("",!0)])}const fe=K(P,[["render",te]]);export{fe as default};
